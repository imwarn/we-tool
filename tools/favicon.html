<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Favicon ç”Ÿæˆå™¨ - æ”¯æŒå›¾ç‰‡ä¸Šä¼ ã€æ–‡å­—è‡ªå®šä¹‰ã€Emoji é€‰æ‹©ï¼Œä¸€é”®ç”Ÿæˆ ICO/PNG æ ¼å¼çš„ç½‘ç«™å›¾æ ‡">
    <meta name="keywords" content="faviconç”Ÿæˆå™¨,icoç”Ÿæˆ,ç½‘ç«™å›¾æ ‡,favicon,icon,emojiå›¾æ ‡">
    <title>Favicon ç”Ÿæˆå™¨ - å¼€å‘è€…å·¥å…·ç®±</title>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ¨</text></svg>">
    
    <!-- å…¬å…±æ ·å¼ -->
    <link rel="stylesheet" href="../assets/css/common.css">
    <link rel="stylesheet" href="../assets/css/tool.css">
    
    <style>
        /* Favicon å·¥å…·ç‰¹å®šæ ·å¼ */
        canvas {
            display: block;
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
        }

        .size-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 12px;
        }

        .size-item {
            padding: 15px;
            background: white;
            border: 2px solid var(--color-secondary);
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .size-item:hover {
            border-color: var(--color-button);
            transform: translateY(-2px);
        }

        .size-item.active {
            background: var(--color-button);
            border-color: var(--color-button);
            color: var(--color-button-text);
        }

        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
            gap: 10px;
            max-height: 300px;
            overflow-y: auto;
            padding: 15px;
            background: var(--color-secondary);
            border-radius: 12px;
        }

        .emoji-item {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s;
            background: white;
        }

        .emoji-item:hover {
            background: var(--color-button);
            transform: scale(1.2);
        }

        .emoji-item.selected {
            background: var(--color-button);
            box-shadow: 0 0 0 3px var(--color-success);
        }

        .font-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 12px;
        }

        .font-item {
            padding: 15px;
            background: white;
            border: 2px solid var(--color-secondary);
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.2em;
        }

        .font-item:hover {
            border-color: var(--color-button);
            transform: translateY(-3px);
        }

        .font-item.active {
            background: var(--color-button);
            border-color: var(--color-button);
            color: var(--color-button-text);
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="../index.html" class="logo">
                <div class="logo-icon">ğŸ› ï¸</div>
                <span data-i18n="nav.home">å¼€å‘è€…å·¥å…·ç®±</span>
            </a>
            <a href="../index.html" class="back-btn">
                <span>â†</span>
                <span data-i18n="common.back">è¿”å›é¦–é¡µ</span>
            </a>
        </div>
    </nav>

    <!-- ä¸»å®¹å™¨ -->
    <div class="container">
        <div class="page-header">
            <h1 class="page-title">ğŸ¨ Favicon ç”Ÿæˆå™¨</h1>
            <p class="page-subtitle">æ”¯æŒå›¾ç‰‡ä¸Šä¼ ã€æ–‡å­—è‡ªå®šä¹‰ã€Emoji é€‰æ‹©ï¼Œä¸€é”®ç”Ÿæˆ ICO/PNG æ ¼å¼å›¾æ ‡</p>
        </div>

        <!-- é…ç½®é¢æ¿ -->
        <div class="tool-panel">
            <h2 class="section-title">ç”Ÿæˆé…ç½®</h2>

            <!-- å°ºå¯¸é€‰æ‹© -->
            <div class="form-group">
                <label class="form-label">é€‰æ‹©å°ºå¯¸</label>
                <div class="size-grid">
                    <div class="size-item" data-size="16" onclick="selectSize(16)">16Ã—16</div>
                    <div class="size-item active" data-size="32" onclick="selectSize(32)">32Ã—32</div>
                    <div class="size-item" data-size="64" onclick="selectSize(64)">64Ã—64</div>
                    <div class="size-item" data-size="128" onclick="selectSize(128)">128Ã—128</div>
                    <div class="size-item" data-size="256" onclick="selectSize(256)">256Ã—256</div>
                </div>
            </div>

            <!-- Tab åˆ‡æ¢ -->
            <div class="form-group">
                <label class="form-label">ç”Ÿæˆæ–¹å¼</label>
                <div class="tabs">
                    <button class="tab-btn" onclick="switchTab('upload', event)">
                        ğŸ“¤ ä¸Šä¼ å›¾ç‰‡
                    </button>
                    <button class="tab-btn active" onclick="switchTab('text', event)">
                        âœï¸ æ–‡å­—ç”Ÿæˆ
                    </button>
                    <button class="tab-btn" onclick="switchTab('emoji', event)">
                        ğŸ˜€ Emoji
                    </button>
                </div>
            </div>

            <!-- Tab 1: ä¸Šä¼ å›¾ç‰‡ -->
            <div class="tab-content" id="tab-upload">
                <div class="upload-area" id="uploadArea" onclick="document.getElementById('imageInput').click()">
                    <div class="upload-icon">ğŸ“</div>
                    <p style="font-size: 1.2em; margin-bottom: 10px; font-weight: 600;">ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ å›¾ç‰‡</p>
                    <p style="opacity: 0.7;">æ”¯æŒ PNGã€JPGã€SVG æ ¼å¼ï¼Œè‡ªåŠ¨æå–é€æ˜èƒŒæ™¯</p>
                </div>
                <input type="file" id="imageInput" accept="image/*" style="display: none;">

                <div class="transparency-control">
                    <label>
                        <input type="checkbox" id="imageKeepTransparency" checked>
                        ä¿æŒé€æ˜èƒŒæ™¯
                    </label>
                </div>
            </div>

            <!-- Tab 2: æ–‡å­—ç”Ÿæˆ -->
            <div class="tab-content active" id="tab-text">
                <div class="form-group">
                    <label class="form-label">è¾“å…¥æ–‡å­—</label>
                    <input 
                        type="text" 
                        class="form-input" 
                        id="textInput"
                        placeholder="è¾“å…¥ 1-2 ä¸ªå­—ç¬¦"
                        maxlength="2"
                        value="D"
                    >
                </div>

                <div class="form-group">
                    <label class="form-label">é€‰æ‹©å­—ä½“</label>
                    <div class="font-grid" id="fontGrid">
                        <div class="font-item active" data-font="Arial" style="font-family: Arial;">Arial</div>
                        <div class="font-item" data-font="'Times New Roman'" style="font-family: 'Times New Roman';">Times</div>
                        <div class="font-item" data-font="'Courier New'" style="font-family: 'Courier New';">Courier</div>
                        <div class="font-item" data-font="'Georgia'" style="font-family: Georgia;">Georgia</div>
                        <div class="font-item" data-font="Impact" style="font-family: Impact;">Impact</div>
                        <div class="font-item" data-font="'Comic Sans MS'" style="font-family: 'Comic Sans MS';">Comic</div>
                    </div>
                </div>

                <div class="color-group">
                    <div class="form-group">
                        <label class="form-label">èƒŒæ™¯é¢œè‰²</label>
                        <div class="color-input-wrapper">
                            <input type="color" id="bgColor" value="#ffd803">
                            <input type="text" class="form-input" id="bgColorText" value="#ffd803">
                        </div>
                        <div class="transparency-control">
                            <label>
                                <input type="checkbox" id="bgTransparent">
                                é€æ˜èƒŒæ™¯
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">æ–‡å­—é¢œè‰²</label>
                        <div class="color-input-wrapper">
                            <input type="color" id="textColor" value="#272343">
                            <input type="text" class="form-input" id="textColorText" value="#272343">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab 3: Emoji -->
            <div class="tab-content" id="tab-emoji">
                <div class="form-group">
                    <label class="form-label">é€‰æ‹© Emoji</label>
                    <div class="emoji-grid" id="emojiGrid"></div>
                </div>

                <div class="form-group">
                    <label class="form-label">èƒŒæ™¯é¢œè‰²</label>
                    <div class="color-input-wrapper">
                        <input type="color" id="emojiBgColor" value="#ffd803">
                        <input type="text" class="form-input" id="emojiBgColorText" value="#ffd803">
                    </div>
                    <div class="transparency-control">
                        <label>
                            <input type="checkbox" id="emojiBgTransparent">
                            é€æ˜èƒŒæ™¯
                        </label>
                    </div>
                </div>
            </div>

            <div class="info-box">
                <h4>ğŸ’¡ ä½¿ç”¨æç¤º</h4>
                <ul>
                    <li><strong>ICO æ ¼å¼</strong>ï¼šæ ‡å‡†æµè§ˆå™¨å›¾æ ‡æ ¼å¼ï¼Œå…¼å®¹æ‰€æœ‰æµè§ˆå™¨</li>
                    <li><strong>PNG æ ¼å¼</strong>ï¼šç°ä»£æ ¼å¼ï¼Œæ”¯æŒé€æ˜èƒŒæ™¯ï¼Œæ–‡ä»¶æ›´å°</li>
                    <li><strong>é€æ˜èƒŒæ™¯</strong>ï¼šå‹¾é€‰åèƒŒæ™¯å®Œå…¨é€æ˜ï¼Œé€‚é…æ·±è‰²/æµ…è‰²ä¸»é¢˜</li>
                    <li><strong>æ¨èå°ºå¯¸</strong>ï¼š32Ã—32 æˆ– 64Ã—64 é€‚åˆå¤§å¤šæ•°åœºæ™¯</li>
                </ul>
            </div>
        </div>

        <!-- é¢„è§ˆå’Œä¸‹è½½ -->
        <div class="tool-panel">
            <h2 class="section-title">é¢„è§ˆå’Œä¸‹è½½</h2>

            <div class="preview-section">
                <div class="preview-label" id="previewLabel">é¢„è§ˆ 32Ã—32</div>
                <div class="preview-box">
                    <canvas id="previewCanvas" width="32" height="32"></canvas>
                </div>

                <div class="btn-group">
                    <button class="btn btn-success" onclick="downloadICO()">
                        <span>ğŸ’¾</span>
                        <span>ä¸‹è½½ ICO æ ¼å¼</span>
                    </button>
                    <button class="btn btn-primary" onclick="downloadPNG()">
                        <span>ğŸ“¥</span>
                        <span>ä¸‹è½½ PNG æ ¼å¼</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- å…¬å…±è„šæœ¬ -->
    <script src="../assets/js/common.js"></script>

    <script>
        // Favicon å·¥å…·é€»è¾‘
        let currentMode = 'text';
        let currentSize = 32;
        let currentFont = 'Arial';
        let sourceImage = null;
        let selectedEmoji = 'ğŸ¨';

        const emojis = [
            'ğŸ˜€', 'ğŸ˜ƒ', 'ğŸ˜„', 'ğŸ˜', 'ğŸ˜…', 'ğŸ˜‚', 'ğŸ¤£', 'ğŸ˜Š', 'ğŸ˜‡', 'ğŸ™‚',
            'ğŸ™ƒ', 'ğŸ˜‰', 'ğŸ˜Œ', 'ğŸ˜', 'ğŸ¥°', 'ğŸ˜˜', 'ğŸ˜—', 'ğŸ˜™', 'ğŸ˜š', 'ğŸ˜‹',
            'ğŸ˜›', 'ğŸ˜', 'ğŸ˜œ', 'ğŸ¤ª', 'ğŸ¤¨', 'ğŸ§', 'ğŸ¤“', 'ğŸ˜', 'ğŸ¤©', 'ğŸ¥³',
            'ğŸ”¥', 'ğŸ’§', 'â­', 'âœ¨', 'ğŸ’«', 'ğŸŒŸ', 'âš¡', 'ğŸ’¥', 'ğŸ’¢', 'ğŸ’¨',
            'ğŸ¨', 'ğŸ­', 'ğŸª', 'ğŸ¬', 'ğŸ¤', 'ğŸ§', 'ğŸ¼', 'ğŸ¹', 'ğŸ¥', 'ğŸ·',
            'ğŸ¸', 'ğŸº', 'ğŸ»', 'ğŸª•', 'ğŸ¥ƒ', 'ğŸ•', 'ğŸ”', 'ğŸŸ', 'ğŸŒ­', 'ğŸ¿',
            'ğŸš€', 'ğŸ›¸', 'ğŸ›°ï¸', 'ğŸŒ', 'ğŸŒ', 'ğŸŒ', 'ğŸ—ºï¸', 'ğŸ”ï¸', 'â›°ï¸', 'ğŸŒ‹',
            'ğŸ•ï¸', 'ğŸ–ï¸', 'ğŸœï¸', 'ğŸï¸', 'ğŸï¸', 'ğŸ’»', 'âŒ¨ï¸', 'ğŸ–¥ï¸', 'ğŸ–¨ï¸', 'ğŸ–±ï¸',
            'âš™ï¸', 'ğŸ”§', 'ğŸ”¨', 'ğŸ› ï¸', 'ğŸ”©', 'âš¡', 'ğŸ”Œ', 'ğŸ’¡', 'ğŸ”¦', 'ğŸ•¯ï¸',
            'ğŸ“±', 'ğŸ“', 'â˜ï¸', 'ğŸ“Ÿ', 'ğŸ“ ', 'ğŸ“¡', 'ğŸ–¥ï¸', 'ğŸ’¾', 'ğŸ’¿', 'ğŸ“€'
        ];

        function selectSize(size) {
            currentSize = size;
            document.querySelectorAll('.size-item').forEach(item => item.classList.remove('active'));
            document.querySelector(`[data-size="${size}"]`).classList.add('active');
            
            const canvas = document.getElementById('previewCanvas');
            canvas.width = size;
            canvas.height = size;
            document.getElementById('previewLabel').textContent = `é¢„è§ˆ ${size}Ã—${size}`;
            
            generateFavicon();
        }

        function switchTab(tab, event) {
            currentMode = tab;
            DevToolkit.switchTab(tab, event);
            generateFavicon();
        }

        function initEmojiGrid() {
            const grid = document.getElementById('emojiGrid');
            emojis.forEach((emoji, index) => {
                const item = document.createElement('div');
                item.className = 'emoji-item';
                if (index === 0) {
                    item.classList.add('selected');
                    selectedEmoji = emoji;
                }
                item.textContent = emoji;
                item.onclick = () => {
                    selectedEmoji = emoji;
                    document.querySelectorAll('.emoji-item').forEach(i => i.classList.remove('selected'));
                    item.classList.add('selected');
                    generateFavicon();
                };
                grid.appendChild(item);
            });
        }

        // å­—ä½“é€‰æ‹©
        document.querySelectorAll('.font-item').forEach(item => {
            item.onclick = () => {
                currentFont = item.dataset.font;
                document.querySelectorAll('.font-item').forEach(i => i.classList.remove('active'));
                item.classList.add('active');
                generateFavicon();
            };
        });

        // é¢œè‰²åŒæ­¥
        ['bg', 'text', 'emojiBg'].forEach(type => {
            const colorInput = document.getElementById(`${type}Color`);
            const textInput = document.getElementById(`${type}ColorText`);
            
            if (colorInput && textInput) {
                colorInput.oninput = () => {
                    textInput.value = colorInput.value;
                    generateFavicon();
                };
                
                textInput.oninput = () => {
                    if (/^#[0-9A-Fa-f]{6}$/.test(textInput.value)) {
                        colorInput.value = textInput.value;
                        generateFavicon();
                    }
                };
            }
        });

        // é€æ˜åº¦æ§åˆ¶
        ['imageKeepTransparency', 'bgTransparent', 'emojiBgTransparent'].forEach(id => {
            const checkbox = document.getElementById(id);
            if (checkbox) {
                checkbox.onchange = generateFavicon;
            }
        });

        // æ–‡å­—è¾“å…¥
        document.getElementById('textInput').oninput = generateFavicon;

        // å›¾ç‰‡ä¸Šä¼ 
        const uploadArea = document.getElementById('uploadArea');
        const imageInput = document.getElementById('imageInput');

        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            uploadArea.addEventListener(eventName, (e) => {
                e.preventDefault();
                e.stopPropagation();
            });
        });

        ['dragenter', 'dragover'].forEach(eventName => {
            uploadArea.addEventListener(eventName, () => uploadArea.classList.add('dragover'));
        });

        ['dragleave', 'drop'].forEach(eventName => {
            uploadArea.addEventListener(eventName, () => uploadArea.classList.remove('dragover'));
        });

        uploadArea.addEventListener('drop', (e) => {
            const files = e.dataTransfer.files;
            if (files.length > 0) handleImageFile(files[0]);
        });

        imageInput.onchange = (e) => {
            if (e.target.files[0]) handleImageFile(e.target.files[0]);
        };

        function handleImageFile(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    sourceImage = img;
                    generateFavicon();
                    DevToolkit.Toast.success('å›¾ç‰‡ä¸Šä¼ æˆåŠŸï¼');
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function generateFavicon() {
            const canvas = document.getElementById('previewCanvas');
            const ctx = canvas.getContext('2d');
            const size = currentSize;

            ctx.clearRect(0, 0, size, size);

            if (currentMode === 'upload') {
                if (!sourceImage) return;
                const keepTransparency = document.getElementById('imageKeepTransparency').checked;
                if (!keepTransparency) {
                    ctx.fillStyle = '#ffffff';
                    ctx.fillRect(0, 0, size, size);
                }
                const scale = Math.min(size / sourceImage.width, size / sourceImage.height);
                const x = (size - sourceImage.width * scale) / 2;
                const y = (size - sourceImage.height * scale) / 2;
                ctx.drawImage(sourceImage, x, y, sourceImage.width * scale, sourceImage.height * scale);
            } else if (currentMode === 'text') {
                const text = document.getElementById('textInput').value || 'D';
                const isTransparent = document.getElementById('bgTransparent').checked;
                if (!isTransparent) {
                    ctx.fillStyle = document.getElementById('bgColor').value;
                    ctx.fillRect(0, 0, size, size);
                }
                const fontSize = size * 0.75;
                ctx.fillStyle = document.getElementById('textColor').value;
                ctx.font = `bold ${fontSize}px ${currentFont}`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(text, size / 2, size / 2);
            } else if (currentMode === 'emoji') {
                const isTransparent = document.getElementById('emojiBgTransparent').checked;
                if (!isTransparent) {
                    ctx.fillStyle = document.getElementById('emojiBgColor').value;
                    ctx.fillRect(0, 0, size, size);
                }
                const fontSize = Math.floor(size * 0.7);
                ctx.font = `${fontSize}px "Segoe UI Emoji", "Apple Color Emoji", "Noto Color Emoji", sans-serif`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(selectedEmoji, size / 2, size / 2);
            }
        }

        function downloadPNG() {
            const canvas = document.getElementById('previewCanvas');
            DevToolkit.downloadFile(
                canvas.toDataURL('image/png'),
                `favicon-${currentSize}x${currentSize}.png`,
                'image/png'
            );
        }

        function downloadICO() {
            const canvas = document.getElementById('previewCanvas');
            const link = document.createElement('a');
            link.download = 'favicon.ico';
            link.href = canvas.toDataURL('image/png');
            link.click();
            DevToolkit.Toast.success('å·²ä¸‹è½½ favicon.ico æ ¼å¼ï¼');
        }

        window.addEventListener('load', () => {
            initEmojiGrid();
            generateFavicon();
        });
    </script>
</body>
</html>